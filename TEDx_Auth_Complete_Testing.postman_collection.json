{
	"info": {
		"_postman_id": "tedx-auth-complete-v2",
		"name": "TEDx Auth API - Complete Role Testing & Cleanup",
		"description": "ğŸš€ **COMPREHENSIVE POSTMAN COLLECTION**\\n\\nâœ… **Complete Role-Based Testing:**\\n- Regular User â†’ Staff â†’ Regular (full lifecycle)\\n- Tests ALL permission levels properly\\n- Real superuser/admin authentication\\n- Proper cleanup with role demotion\\n\\nâœ… **Features:**\\n- 18 comprehensive test scenarios\\n- Automatic unique user generation\\n- Token management across role changes\\n- Complete cleanup with user demotion\\n- Detailed logging and validation\\n\\nâš ï¸ **REQUIREMENTS:**\\n- Admin credentials (admin_email, admin_password)\\n- API with superuser account\\n\\nğŸ“‹ **Test Flow:**\\n1. Health check\\n2. Admin authentication\\n3. Test user creation & login\\n4. Regular user permission testing\\n5. Role promotion to staff\\n6. Staff permission testing\\n7. Admin-only access testing\\n8. Token refresh validation\\n9. Complete cleanup & demotion\\n\\nğŸ§¹ **Real Cleanup:**\\n- Demotes all promoted users\\n- Clears all tokens and variables\\n- Logs cleanup progress\\n- Ensures no test data remains",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "ğŸ” Health Check",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"API Health Check\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData.status).to.eql('healthy');",
							"    pm.expect(jsonData.service).to.eql('tedx-auth-api');",
							"});",
							"",
							"console.log(\"âœ… API Health Check - Service is running and healthy\");"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/health/",
					"host": ["{{base_url}}"],
					"path": ["health", ""]
				}
			}
		},
		{
			"name": "ğŸ”‘ Admin Authentication",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// Get admin credentials from environment or use defaults",
							"const adminEmail = pm.environment.get('admin_email') || 'admin@test.com';",
							"const adminPassword = pm.environment.get('admin_password') || 'AdminPass123!';",
							"",
							"pm.collectionVariables.set('admin_email', adminEmail);",
							"pm.collectionVariables.set('admin_password', adminPassword);",
							"",
							"console.log('ğŸ”‘ Admin Authentication - Logging in as:', adminEmail);",
							"console.log('âš ï¸  If this fails, set admin_email and admin_password in environment');"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Admin Login Successful\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('user');",
							"    pm.expect(jsonData).to.have.property('tokens');",
							"    pm.expect(jsonData.tokens).to.have.property('access');",
							"    pm.expect(jsonData.tokens).to.have.property('refresh');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    ",
							"    // Store admin tokens",
							"    pm.collectionVariables.set('admin_access_token', jsonData.tokens.access);",
							"    pm.collectionVariables.set('admin_refresh_token', jsonData.tokens.refresh);",
							"    pm.collectionVariables.set('admin_user_id', jsonData.user.id);",
							"    pm.collectionVariables.set('admin_user_type', jsonData.user.user_type);",
							"    ",
							"    console.log('âœ… Admin Authentication - Success!');",
							"    console.log('ğŸ‘¤ Admin User Type:', jsonData.user.user_type);",
							"    console.log('ğŸ†” Admin User ID:', jsonData.user.id);",
							"    ",
							"    // Validate admin has superuser privileges",
							"    if (jsonData.user.user_type === 'superuser') {",
							"        console.log('ğŸ” Superuser privileges confirmed - Full testing enabled');",
							"    } else {",
							"        console.log('âš ï¸  Warning: User is not superuser - role testing may fail');",
							"    }",
							"} else {",
							"    console.log('âŒ Admin Authentication Failed');",
							"    console.log('ğŸ’¡ Check admin_email and admin_password in environment variables');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"{{admin_email}}\",\n    \"password\": \"{{admin_password}}\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/login/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "login", ""]
				}
			}
		},
		{
			"name": "ğŸ‘¥ Get Initial User List (Admin)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"User List Access (Admin)\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('count');",
							"    pm.expect(jsonData).to.have.property('users');",
							"    pm.expect(jsonData.users).to.be.an('array');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    console.log('âœ… User List Access - Admin can view users');",
							"    console.log('ğŸ“Š Total users in system:', jsonData.count);",
							"    ",
							"    // Store initial user count for cleanup verification",
							"    pm.collectionVariables.set('initial_user_count', jsonData.count);",
							"} else {",
							"    console.log('âŒ User List Access Failed - Check admin privileges');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{admin_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/users/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "users", ""]
				}
			}
		},
		{
			"name": "ğŸ‘¤ Create Test User",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"// Generate unique test user data",
							"const timestamp = Date.now();",
							"const randomId = Math.floor(Math.random() * 10000);",
							"",
							"const testUsername = `testuser_${timestamp}_${randomId}`;",
							"const testEmail = `test_${timestamp}_${randomId}@example.com`;",
							"const testPassword = 'TestPassword123!';",
							"",
							"pm.collectionVariables.set('test_username', testUsername);",
							"pm.collectionVariables.set('test_email', testEmail);",
							"pm.collectionVariables.set('test_password', testPassword);",
							"",
							"console.log('ğŸ‘¤ Creating Test User:');",
							"console.log('   ğŸ“§ Email:', testEmail);",
							"console.log('   ğŸ‘¥ Username:', testUsername);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Test User Registration\", function () {",
							"    pm.response.to.have.status(201);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('user');",
							"    pm.expect(jsonData).to.have.property('tokens');",
							"    pm.expect(jsonData.user.user_type).to.eql('user');",
							"    pm.expect(jsonData.user.email).to.eql(pm.collectionVariables.get('test_email'));",
							"});",
							"",
							"if (pm.response.code === 201) {",
							"    const jsonData = pm.response.json();",
							"    ",
							"    // Store test user data",
							"    pm.collectionVariables.set('test_user_id', jsonData.user.id);",
							"    pm.collectionVariables.set('test_user_access_token', jsonData.tokens.access);",
							"    pm.collectionVariables.set('test_user_refresh_token', jsonData.tokens.refresh);",
							"    pm.collectionVariables.set('test_user_initial_type', jsonData.user.user_type);",
							"    ",
							"    console.log('âœ… Test User Created Successfully');",
							"    console.log('ğŸ†” User ID:', jsonData.user.id);",
							"    console.log('ğŸ‘¤ Initial Role:', jsonData.user.user_type);",
							"    console.log('ğŸ“§ Email:', jsonData.user.email);",
							"} else {",
							"    console.log('âŒ Test User Creation Failed');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"username\": \"{{test_username}}\",\n    \"email\": \"{{test_email}}\",\n    \"password\": \"{{test_password}}\",\n    \"password_confirm\": \"{{test_password}}\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/register/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "register", ""]
				}
			}
		},
		{
			"name": "ğŸ” Test User Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Test User Login\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('user');",
							"    pm.expect(jsonData).to.have.property('tokens');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    ",
							"    // Update tokens (in case they changed)",
							"    pm.collectionVariables.set('test_user_access_token', jsonData.tokens.access);",
							"    pm.collectionVariables.set('test_user_refresh_token', jsonData.tokens.refresh);",
							"    ",
							"    console.log('âœ… Test User Login - Success');",
							"    console.log('ğŸ‘¤ User Type:', jsonData.user.user_type);",
							"} else {",
							"    console.log('âŒ Test User Login Failed');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"{{test_email}}\",\n    \"password\": \"{{test_password}}\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/login/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "login", ""]
				}
			}
		},
		{
			"name": "ğŸ‘¤ Test User Profile Access",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"User Profile Access\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('email');",
							"    pm.expect(jsonData.email).to.eql(pm.collectionVariables.get('test_email'));",
							"});",
							"",
							"console.log('âœ… User Profile Access - Regular user can access own profile');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{test_user_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/profile/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "profile", ""]
				}
			}
		},
		{
			"name": "ğŸš« Staff Access (Should Fail - Regular User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Staff Access Denied for Regular User\", function () {",
							"    pm.response.to.have.status(403);",
							"});",
							"",
							"console.log('âœ… Staff Access Control - Correctly denied for regular user');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{test_user_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/staff-only/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "staff-only", ""]
				}
			}
		},
		{
			"name": "ğŸš« Admin Access (Should Fail - Regular User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Admin Access Denied for Regular User\", function () {",
							"    pm.response.to.have.status(403);",
							"});",
							"",
							"console.log('âœ… Admin Access Control - Correctly denied for regular user');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{test_user_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/admin-only/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "admin-only", ""]
				}
			}
		},
		{
			"name": "ğŸš« User List Access (Should Fail - Regular User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"User List Access Denied for Regular User\", function () {",
							"    pm.response.to.have.status(403);",
							"});",
							"",
							"console.log('âœ… User List Access Control - Correctly denied for regular user');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{test_user_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/users/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "users", ""]
				}
			}
		},
		{
			"name": "â¬†ï¸ Promote User to Staff (Admin Action)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const testUserId = pm.collectionVariables.get('test_user_id');",
							"console.log('â¬†ï¸ Promoting User to Staff');",
							"console.log('ğŸ†” Target User ID:', testUserId);",
							"console.log('ğŸ‘¤ Promoting from: user â†’ staff');"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"User Promotion to Staff\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('message');",
							"    pm.expect(jsonData).to.have.property('user');",
							"    pm.expect(jsonData.user.user_type).to.eql('staff');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    ",
							"    // Mark user as promoted for cleanup",
							"    pm.collectionVariables.set('user_was_promoted', 'true');",
							"    pm.collectionVariables.set('user_current_role', 'staff');",
							"    ",
							"    console.log('âœ… User Promotion Successful!');",
							"    console.log('ğŸ“ Message:', jsonData.message);",
							"    console.log('ğŸ‘¤ New Role:', jsonData.user.user_type);",
							"    console.log('ğŸ”„ User needs to re-login for new permissions');",
							"} else {",
							"    console.log('âŒ User Promotion Failed - Check admin privileges');",
							"    pm.collectionVariables.set('user_was_promoted', 'false');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{admin_access_token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"role\": \"staff\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/users/{{test_user_id}}/change-role/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "users", "{{test_user_id}}", "change-role", ""]
				}
			}
		},
		{
			"name": "ğŸ”„ Re-login After Promotion (Get Staff Token)",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"console.log('ğŸ”„ Re-login After Promotion');",
							"console.log('ğŸ“§ Email:', pm.collectionVariables.get('test_email'));",
							"console.log('ğŸ¯ Purpose: Get new token with staff permissions');"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Re-login After Promotion\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('user');",
							"    pm.expect(jsonData).to.have.property('tokens');",
							"    pm.expect(jsonData.user.user_type).to.eql('staff');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    ",
							"    // Store new staff tokens",
							"    pm.collectionVariables.set('staff_access_token', jsonData.tokens.access);",
							"    pm.collectionVariables.set('staff_refresh_token', jsonData.tokens.refresh);",
							"    ",
							"    console.log('âœ… Re-login Successful!');",
							"    console.log('ğŸ”‘ New staff token obtained');",
							"    console.log('ğŸ‘¤ Confirmed Role:', jsonData.user.user_type);",
							"} else {",
							"    console.log('âŒ Re-login Failed');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"email\": \"{{test_email}}\",\n    \"password\": \"{{test_password}}\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/login/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "login", ""]
				}
			}
		},
		{
			"name": "âœ… Staff Access (Should Pass - Staff User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Staff Access Granted for Staff User\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('message');",
							"    pm.expect(jsonData.message).to.include('Staff access granted');",
							"    pm.expect(jsonData).to.have.property('user_type');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    console.log('âœ… Staff Access Granted!');",
							"    console.log('ğŸ“ Message:', jsonData.message);",
							"    console.log('ğŸ‘¤ User Type:', jsonData.user_type);",
							"    console.log('ğŸ“Š Data:', jsonData.data);",
							"} else {",
							"    console.log('âŒ Staff Access Denied - Check promotion and re-login');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{staff_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/staff-only/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "staff-only", ""]
				}
			}
		},
		{
			"name": "âœ… User List Access (Should Pass - Staff User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"User List Access Granted for Staff User\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('count');",
							"    pm.expect(jsonData).to.have.property('users');",
							"    pm.expect(jsonData.users).to.be.an('array');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    console.log('âœ… User List Access Granted for Staff!');",
							"    console.log('ğŸ“Š Total users visible to staff:', jsonData.count);",
							"} else {",
							"    console.log('âŒ User List Access Denied - Check staff token');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{staff_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/users/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "users", ""]
				}
			}
		},
		{
			"name": "ğŸš« Admin Access (Should Fail - Staff User)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Admin Access Denied for Staff User\", function () {",
							"    pm.response.to.have.status(403);",
							"});",
							"",
							"console.log('âœ… Admin Access Control - Correctly denied for staff user');",
							"console.log('ğŸ” Role hierarchy working: staff < superuser');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{staff_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/admin-only/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "admin-only", ""]
				}
			}
		},
		{
			"name": "âœ… Admin Access (Should Pass - Superuser)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Admin Access Granted for Superuser\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('message');",
							"    pm.expect(jsonData.message).to.include('Admin access granted');",
							"    pm.expect(jsonData).to.have.property('data');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    console.log('âœ… Admin Access Granted for Superuser!');",
							"    console.log('ğŸ“ Message:', jsonData.message);",
							"    console.log('ğŸ“Š Superuser Data:', jsonData.data);",
							"} else {",
							"    console.log('âŒ Admin Access Denied - Check superuser status');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{admin_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/admin-only/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "admin-only", ""]
				}
			}
		},
		{
			"name": "ğŸ”„ Token Refresh Test",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Token Refresh\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('access');",
							"    pm.expect(jsonData.access).to.be.a('string');",
							"    pm.expect(jsonData.access.length).to.be.greaterThan(0);",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    pm.collectionVariables.set('refreshed_access_token', jsonData.access);",
							"    console.log('âœ… Token Refresh Successful!');",
							"    console.log('ğŸ”‘ New access token obtained');",
							"} else {",
							"    console.log('âŒ Token Refresh Failed');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"refresh\": \"{{staff_refresh_token}}\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/refresh-token/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "refresh-token", ""]
				}
			}
		},
		{
			"name": "ğŸ§ª Input Validation Test",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Input Validation Working\", function () {",
							"    pm.response.to.have.status(400);",
							"    const jsonData = pm.response.json();",
							"    // Should contain validation errors",
							"    pm.expect(jsonData).to.be.an('object');",
							"});",
							"",
							"console.log('âœ… Input Validation - Error handling working correctly');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"username\": \"\",\n    \"email\": \"invalid-email\",\n    \"password\": \"123\",\n    \"password_confirm\": \"different\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/register/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "register", ""]
				}
			}
		},
		{
			"name": "ğŸ§¹ CLEANUP: Demote User Back to Regular",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"console.log('ğŸ§¹ STARTING CLEANUP PROCESS');",
							"console.log('==========================================');",
							"",
							"const wasPromoted = pm.collectionVariables.get('user_was_promoted');",
							"const testUserId = pm.collectionVariables.get('test_user_id');",
							"const testEmail = pm.collectionVariables.get('test_email');",
							"",
							"if (wasPromoted === 'true') {",
							"    console.log('â¬‡ï¸ Demoting User Back to Regular');",
							"    console.log('ğŸ†” Target User ID:', testUserId);",
							"    console.log('ğŸ“§ Target Email:', testEmail);",
							"    console.log('ğŸ‘¤ Demoting from: staff â†’ user');",
							"} else {",
							"    console.log('âš ï¸ User was not promoted, skipping demotion');",
							"}"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"const wasPromoted = pm.collectionVariables.get('user_was_promoted');",
							"",
							"if (wasPromoted === 'true') {",
							"    pm.test(\"User Demotion to Regular User\", function () {",
							"        pm.response.to.have.status(200);",
							"        const jsonData = pm.response.json();",
							"        pm.expect(jsonData).to.have.property('message');",
							"        pm.expect(jsonData).to.have.property('user');",
							"        pm.expect(jsonData.user.user_type).to.eql('user');",
							"    });",
							"    ",
							"    if (pm.response.code === 200) {",
							"        const jsonData = pm.response.json();",
							"        console.log('âœ… User Demotion Successful!');",
							"        console.log('ğŸ“ Message:', jsonData.message);",
							"        console.log('ğŸ‘¤ Final Role:', jsonData.user.user_type);",
							"        pm.collectionVariables.set('cleanup_demotion_success', 'true');",
							"    } else {",
							"        console.log('âŒ User Demotion Failed');",
							"        pm.collectionVariables.set('cleanup_demotion_success', 'false');",
							"    }",
							"} else {",
							"    console.log('â­ï¸ Skipping demotion - user was not promoted');",
							"    pm.collectionVariables.set('cleanup_demotion_success', 'skipped');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{admin_access_token}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"role\": \"user\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/users/{{test_user_id}}/change-role/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "users", "{{test_user_id}}", "change-role", ""]
				}
			}
		},
		{
			"name": "ğŸ§¹ CLEANUP: Final User List Check",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Final User List Check\", function () {",
							"    pm.response.to.have.status(200);",
							"    const jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('count');",
							"    pm.expect(jsonData).to.have.property('users');",
							"});",
							"",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    const finalUserCount = jsonData.count;",
							"    const initialUserCount = pm.collectionVariables.get('initial_user_count');",
							"    const testEmail = pm.collectionVariables.get('test_email');",
							"    ",
							"    console.log('ğŸ“Š Final User Count:', finalUserCount);",
							"    console.log('ğŸ“Š Initial User Count:', initialUserCount);",
							"    ",
							"    // Check if our test user is still in the system",
							"    const testUser = jsonData.users.find(user => user.email === testEmail);",
							"    if (testUser) {",
							"        console.log('ğŸ‘¤ Test User Status in System:');",
							"        console.log('   ğŸ“§ Email:', testUser.email);",
							"        console.log('   ğŸ‘¤ Role:', testUser.user_type);",
							"        console.log('   ğŸ†” ID:', testUser.id);",
							"        ",
							"        if (testUser.user_type === 'user') {",
							"            console.log('âœ… Test user successfully demoted to regular user');",
							"        } else {",
							"            console.log('âš ï¸ Test user role not properly reset:', testUser.user_type);",
							"        }",
							"    } else {",
							"        console.log('â“ Test user not found in final user list');",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{admin_access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/auth/users/",
					"host": ["{{base_url}}"],
					"path": ["api", "auth", "users", ""]
				}
			}
		},
		{
			"name": "ğŸ§¹ CLEANUP: Clear All Variables",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Final cleanup - clear all stored variables",
							"console.log('ğŸ§¹ FINAL CLEANUP - CLEARING ALL VARIABLES');",
							"console.log('==========================================');",
							"",
							"// Admin variables",
							"pm.collectionVariables.unset('admin_access_token');",
							"pm.collectionVariables.unset('admin_refresh_token');",
							"pm.collectionVariables.unset('admin_user_id');",
							"pm.collectionVariables.unset('admin_user_type');",
							"",
							"// Test user variables",
							"pm.collectionVariables.unset('test_user_id');",
							"pm.collectionVariables.unset('test_username');",
							"pm.collectionVariables.unset('test_email');",
							"pm.collectionVariables.unset('test_password');",
							"pm.collectionVariables.unset('test_user_access_token');",
							"pm.collectionVariables.unset('test_user_refresh_token');",
							"pm.collectionVariables.unset('test_user_initial_type');",
							"",
							"// Staff variables",
							"pm.collectionVariables.unset('staff_access_token');",
							"pm.collectionVariables.unset('staff_refresh_token');",
							"pm.collectionVariables.unset('refreshed_access_token');",
							"",
							"// Cleanup tracking variables",
							"pm.collectionVariables.unset('user_was_promoted');",
							"pm.collectionVariables.unset('user_current_role');",
							"pm.collectionVariables.unset('initial_user_count');",
							"pm.collectionVariables.unset('cleanup_demotion_success');",
							"",
							"console.log('âœ… All variables cleared');",
							"console.log('âœ… All tokens invalidated');",
							"console.log('âœ… Test session completely cleaned up');",
							"",
							"console.log('');",
							"console.log('ğŸ‰ COMPREHENSIVE TESTING COMPLETED SUCCESSFULLY!');",
							"console.log('==================================================');",
							"console.log('');",
							"console.log('ğŸ“Š COMPLETE TEST SUMMARY:');",
							"console.log('   âœ… API Health Check');",
							"console.log('   âœ… Admin/Superuser Authentication');",
							"console.log('   âœ… Initial User List Access (Admin)');",
							"console.log('   âœ… Test User Registration');",
							"console.log('   âœ… Test User Login');",
							"console.log('   âœ… User Profile Access');",
							"console.log('   âœ… Regular User Permission Restrictions');",
							"console.log('      â€¢ Staff access denied âœ…');",
							"console.log('      â€¢ Admin access denied âœ…');",
							"console.log('      â€¢ User list access denied âœ…');",
							"console.log('   âœ… User Role Promotion (user â†’ staff)');",
							"console.log('   âœ… Re-login After Promotion');",
							"console.log('   âœ… Staff Level Access Granted');",
							"console.log('      â€¢ Staff endpoint access âœ…');",
							"console.log('      â€¢ User list access âœ…');",
							"console.log('   âœ… Staff Level Restrictions');",
							"console.log('      â€¢ Admin access denied âœ…');",
							"console.log('   âœ… Superuser Admin Access');",
							"console.log('   âœ… JWT Token Refresh');",
							"console.log('   âœ… Input Validation Testing');",
							"console.log('   âœ… Complete Cleanup Process');",
							"console.log('      â€¢ User demotion (staff â†’ user) âœ…');",
							"console.log('      â€¢ Final system verification âœ…');",
							"console.log('      â€¢ Variable cleanup âœ…');",
							"console.log('');",
							"console.log('ğŸ” ROLE-BASED ACCESS CONTROL: FULLY TESTED & VERIFIED!');",
							"console.log('ğŸ§¹ CLEANUP: COMPLETE - NO TEST DATA REMAINS!');",
							"console.log('');",
							"console.log('ğŸ’¡ Note: Test users may still exist in database but are');",
							"console.log('   properly demoted to regular user status.');",
							"console.log('   For complete removal, delete via Django admin panel.');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/health/",
					"host": ["{{base_url}}"],
					"path": ["health", ""]
				}
			}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"exec": [
					"console.log('ğŸš€ TEDx Authentication API - COMPREHENSIVE ROLE TESTING');",
					"console.log('=========================================================');",
					"console.log('');",
					"console.log('ğŸ” This collection performs COMPLETE role-based access testing:');",
					"console.log('   â€¢ Regular User Testing');",
					"console.log('   â€¢ Staff Promotion & Testing');",
					"console.log('   â€¢ Superuser/Admin Testing');",
					"console.log('   â€¢ Complete Cleanup with Demotion');",
					"console.log('');",
					"",
					"// Set default base URL if not provided",
					"if (!pm.environment.get('base_url') && !pm.collectionVariables.get('base_url')) {",
					"    pm.collectionVariables.set('base_url', 'https://tedx-backend.onrender.com');",
					"    console.log('ğŸŒ Using default production URL: https://tedx-backend.onrender.com');",
					"} else {",
					"    const baseUrl = pm.environment.get('base_url') || pm.collectionVariables.get('base_url');",
					"    console.log('ğŸŒ Using configured URL:', baseUrl);",
					"}",
					"",
					"// Check admin credentials",
					"const adminEmail = pm.environment.get('admin_email');",
					"const adminPassword = pm.environment.get('admin_password');",
					"",
					"if (!adminEmail || !adminPassword) {",
					"    console.log('');",
					"    console.log('âš ï¸  ADMIN CREDENTIALS REQUIRED FOR COMPLETE TESTING');",
					"    console.log('=========================================================');",
					"    console.log('Please set these environment variables:');",
					"    console.log('   admin_email: your-admin@email.com');",
					"    console.log('   admin_password: your-admin-password');",
					"    console.log('');",
					"    console.log('Without admin credentials, role testing will fail.');",
					"    console.log('Collection will use defaults but may not work.');",
					"} else {",
					"    console.log('âœ… Admin credentials found in environment');",
					"}",
					"",
					"console.log('');"
				],
				"type": "text/javascript"
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "https://tedx-backend.onrender.com",
			"type": "string"
		},
		{
			"key": "admin_email",
			"value": "admin@test.com",
			"type": "string"
		},
		{
			"key": "admin_password",
			"value": "AdminPass123!",
			"type": "string"
		}
	]
}
