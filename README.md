# 🔐 TEDx Authentication API

A **production-ready** authentication system built with **Django REST Framework**, featuring comprehensive security, JWT tokens, Google OAuth, and role-based access control.

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

## ✨ Key Features

### 🔒 Authentication & Security

- ✅ **Email/password** registration and login with validation
- ✅ **Secure password hashing** (PBKDF2)
- ✅ **JWT tokens** for session management (access + refresh)
- ✅ **Google OAuth 2.0** integration
- ✅ **Role-based access control** (user/staff/superuser)
- ✅ **Token refresh** logic with expiration handling
- ✅ **Superuser creation protection** for production security

### 🛡️ Security Features

- ✅ **No privilege escalation** in registration or OAuth
- ✅ **Input validation** and sanitization
- ✅ **Production-grade** security configurations
- ✅ **Environment-based** protection mechanisms
- ✅ **HTTPS enforcement** in production
- ✅ **HSTS headers** for enhanced security

### 🚀 Production Ready

- ✅ **Render deployment** configuration with auto-deploy
- ✅ **PostgreSQL** database support
- ✅ **Environment variables** management
- ✅ **Database migrations** included
- ✅ **CORS configuration**
- ✅ **Health check endpoint**
- ✅ **Optimized Gunicorn** configuration
- ✅ **Static file handling** with WhiteNoise

## 🧪 Test Coverage

**✅ All 7 Requirements Verified:**

1. Email & password signup/login with validation
2. Secure password hashing
3. JWT for login sessions
4. Google Sign-In (OAuth)
5. Role-based access (admin/user/staff)
6. Token refresh logic
7. Superuser creation protection

---

## 🚀 Quick Start

### 📦 Local Development

```bash
# 1. Clone the repository
git clone https://github.com/yourusername/tedx-backend.git
cd tedx-backend

# 2. Create and activate virtual environment
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 3. Install dependencies
pip install -r requirements.txt

# 4. Set up environment variables
cp .env.example .env
# Edit .env with your configuration

# 5. Run migrations
python manage.py migrate

# 6. Start development server
python manage.py runserver
```

### 🌐 Deploy to Render (One-Click)

1. **Fork this repository** to your GitHub account
2. **Click the Deploy to Render button** above
3. **Set environment variables** in Render Dashboard:
   - `GOOGLE_CLIENT_ID` (from Google Console)
   - `GOOGLE_CLIENT_SECRET` (from Google Console)
   - `CORS_ALLOWED_ORIGINS` (your frontend URLs)
4. **Deploy** - Render will automatically build and deploy!

---

## ⚙️ Configuration

### 🔧 Environment Variables (`.env`)

```env
# === Django Core ===
SECRET_KEY=your-super-secret-django-key
DEBUG=False
### ⚙️ Environment Configuration

#### 🔧 Development (.env file)

```env
# Django Configuration
SECRET_KEY=your-secret-key-here
DEBUG=True

# Database (SQLite for development)
# DATABASE_URL not needed for SQLite

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# CORS & Security
ALLOWED_HOSTS=localhost,127.0.0.1
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
```

#### 🚀 Production (Render Dashboard)

Set these environment variables in your Render dashboard:

| Variable | Value | Description |
|----------|-------|-------------|
| `SECRET_KEY` | Auto-generated | Django secret key (auto-generated by Render) |
| `DEBUG` | `False` | Disable debug mode for production |
| `DATABASE_URL` | Auto-populated | PostgreSQL connection string |
| `GOOGLE_CLIENT_ID` | Your value | Google OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | Your value | Google OAuth client secret |
| `CORS_ALLOWED_ORIGINS` | Your URLs | Frontend URLs (comma-separated) |
| `ALLOWED_HOSTS` | `.onrender.com` | Allowed host patterns |

---

## 🌐 API Reference

### 🔐 Authentication Endpoints

| Method | Endpoint                 | Description                           | Auth Required |
| ------ | ------------------------ | ------------------------------------- | ------------- |
| `POST` | `/api/auth/register/`    | Register new user with email/password | ❌            |
| `POST` | `/api/auth/login/`       | Login and receive JWT tokens          | ❌            |
| `POST` | `/api/auth/google-auth/` | Authenticate with Google OAuth token  | ❌            |
| `POST` | `/api/auth/refresh/`     | Refresh expired access token          | ❌            |
| `GET`  | `/health/`               | Health check endpoint                 | ❌            |

### 🔒 Protected Endpoints
## 🚀 Deployment Guide

### 📋 Pre-deployment Checklist

- ✅ Database reset and fresh migrations
- ✅ Updated configuration files
- ✅ Environment variables configured
- ✅ Static files optimization
- ✅ Security settings for production
- ✅ Health check endpoint added

### 🔄 Manual Deployment Steps

1. **Reset and prepare repository:**
   ```bash
   # This has been done for you:
   # - Database reset
   # - Fresh migrations created
   # - Cache files cleaned
   # - Configuration optimized
   ```

2. **Push to GitHub:**
   ```bash
   git add .
   git commit -m "feat: production-ready deployment with optimized configuration"
   git push origin main
   ```

3. **Deploy to Render:**
   - Fork this repository
   - Connect to Render
   - Set environment variables (see configuration above)
   - Deploy automatically

### 📊 Optimization Features

- **Database:** PostgreSQL with connection pooling
- **Static Files:** WhiteNoise with compression
- **Web Server:** Gunicorn with optimized workers
- **Security:** HTTPS enforcement, HSTS headers
- **Monitoring:** Health check endpoint at `/health/`
- **Logging:** Structured logging for production

---

## 🧪 Testing

### 🔬 Run Tests

```bash
# All tests
python manage.py test

# Specific app
python manage.py test authentication

# With coverage
pip install coverage
coverage run --source='.' manage.py test
coverage report
```

---

## 📊 API Endpoints

### 🔐 Authentication

| Method | Endpoint                 | Description                           | Auth Required |
| ------ | ------------------------ | ------------------------------------- | ------------- |
| `POST` | `/api/auth/register/`    | Register new user with email/password | ❌            |
| `POST` | `/api/auth/login/`       | Login and receive JWT tokens          | ❌            |
| `POST` | `/api/auth/google-auth/` | Authenticate with Google OAuth token  | ❌            |
| `POST` | `/api/auth/refresh/`     | Refresh expired access token          | ❌            |
| `GET`  | `/health/`               | Health check endpoint                 | ❌            |

### 👤 User Management

| Method  | Endpoint                     | Description                  | Auth Required |
| ------- | ---------------------------- | ---------------------------- | ------------- |
| `GET`   | `/api/auth/profile/`         | Get user profile information | 🔒 User        |
| `GET`   | `/api/auth/staff-only/`      | Staff-only endpoint          | 👔 Staff+     |
| `GET`   | `/api/auth/admin-only/`      | Admin-only endpoint          | 👑 Superuser  |
| `GET`   | `/api/auth/users/`           | List all users (paginated)   | 👔 Staff+     |
| `PATCH` | `/api/auth/users/{id}/role/` | Change user role             | 👑 Superuser  |

### � Request/Response Examples

#### Register User

```bash
POST /api/auth/register/
Content-Type: application/json

{
    "username": "johndoe",
    "email": "john@example.com",
    "password": "SecurePassword123!",
    "password_confirm": "SecurePassword123!"
}
```

#### Login

```bash
POST /api/auth/login/
Content-Type: application/json

{
    "email": "john@example.com",
    "password": "SecurePassword123!"
}
```

#### Google OAuth

```bash
POST /api/auth/google-auth/
Content-Type: application/json

{
    "google_token": "your-google-oauth-token"
}
```

#### Access Protected Endpoint

```bash
GET /api/auth/profile/
Authorization: Bearer <your-access-token>
```

### 🔑 Authentication Flow

1. **Register/Login** → Receive `access_token` + `refresh_token`
2. **Use access_token** for API requests in `Authorization: Bearer <token>`
3. **When access_token expires** → Use `refresh_token` to get new `access_token`
4. **Role-based access** → Different endpoints require different permission levels

---

---

## 🧪 Testing & Quality Assurance

### ✅ Comprehensive Test Suite

Our authentication system includes **23 comprehensive tests** covering all requirements:

#### 📊 Test Coverage

- **Email & Password Auth**: Registration, login, validation
- **Security**: Password hashing, token security, privilege escalation prevention
- **JWT Tokens**: Generation, validation, expiration, refresh
- **Google OAuth**: Token verification, user creation, profile updates
- **Role-Based Access**: User/staff/superuser permissions, endpoint protection
- **Token Refresh**: Valid/invalid tokens, expiration handling
- **Production Security**: Superuser creation protection

#### 🚀 Running Tests

```bash
# Quick verification - all requirements
python test_runner.py requirements

# Full test suite (23 tests)
python test_runner.py all

# Individual test suites
python test_runner.py main      # Core functionality (20 tests)
python test_runner.py security  # Security features (2 tests)
python test_runner.py verbose   # Detailed test output

# Django test runner
python manage.py test authentication.test
```

#### 📋 Test Results

```
✅ ALL REQUIREMENTS VERIFIED:
✅ Email & password signup/login with validation
✅ Secure password hashing
✅ JWT for login sessions
✅ Google Sign-In (OAuth)
✅ Role-based access (admin/user/staff)
✅ Token refresh logic
✅ Superuser creation protection

🎉 TEDx Authentication System - All 7 requirements implemented!
🚀 Ready for deployment on Render!
```

**📄 Detailed Report**: See `TEST_SUITE_REPORT.md` for comprehensive test documentation.

---

## 🛡️ Security Features

### 🔒 Production Security

- **Secure password hashing** with PBKDF2
- **JWT token authentication** with access/refresh pattern
- **Role-based access control** (user/staff/superuser)
- **Input validation** and sanitization
- **No privilege escalation** in registration or OAuth
- **Environment-based protection** for superuser creation
- **CORS configuration** for cross-origin requests

### 🔐 Authentication Security

- **Email format validation**
- **Password strength requirements**
- **Token expiration handling**
- **Invalid token rejection**
- **Session management**
- **OAuth token verification**

### 🛡️ Authorization Security

- **Role-based endpoint protection**
- **Permission-based access control**
- **Superuser-only role management**
- **Staff-level user listing**
- **Protected profile access**

---

## 🚀 Deployment

### 📦 Render Deployment

This project is configured for **one-click deployment** on Render:

1. **Fork** this repository
2. **Create Web Service** on Render
3. **Connect** your forked repository
4. **Set environment variables** (see configuration above)
5. **Deploy** - Render automatically runs migrations

#### 🔧 Render Configuration (`render.yaml`)

The project includes a `render.yaml` file for automatic deployment configuration:

```yaml
services:
  - type: web
    name: tedx-authentication-api
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn auth_api.wsgi:application
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "False"
      - key: ENVIRONMENT
        value: "production"
```

### 🔐 Superuser Creation in Production

For security, superuser creation is **protected in production**:

```bash
# Set the protection key in your environment
export SUPERUSER_CREATION_KEY=your-secret-key

# Then create superuser (only works with the key)
python manage.py createsuperuser
```

This prevents unauthorized superuser creation in production while allowing normal development workflow.

---

## 📁 Project Structure

```
tedx-backend/
├── auth_api/                 # Django project settings
│   ├── settings.py          # Configuration with security features
│   ├── urls.py              # Main URL routing
│   └── wsgi.py              # WSGI configuration
├── authentication/          # Authentication app
│   ├── models.py            # User model with Google OAuth support
│   ├── views.py             # API endpoints and authentication logic
│   ├── serializers.py       # Data validation and serialization
│   ├── permissions.py       # Role-based permission classes
│   ├── urls.py              # Authentication URL patterns
│   └── test.py              # Comprehensive test suite (23 tests)
├── test_runner.py           # Convenient test execution script
├── TEST_SUITE_REPORT.md     # Detailed test documentation
├── requirements.txt         # Python dependencies
├── render.yaml              # Render deployment configuration
└── README.md                # This documentation
```

---

## 🤝 Contributing

1. **Fork** the repository
2. **Create** a feature branch (`git checkout -b feature/amazing-feature`)
3. **Run tests** to ensure everything works (`python test_runner.py all`)
4. **Commit** your changes (`git commit -m 'Add amazing feature'`)
5. **Push** to the branch (`git push origin feature/amazing-feature`)
6. **Open** a Pull Request

### 🧪 Before Contributing

- Run the full test suite: `python test_runner.py all`
- Ensure all tests pass: `23/23 tests passing ✅`
- Add tests for new features
- Update documentation as needed

---

## 📞 Support

- **📧 Issues**: [GitHub Issues](https://github.com/Afsalkalladi/tedx-backend/issues)
- **📋 Documentation**: See `TEST_SUITE_REPORT.md` for detailed test coverage
- **🔧 Configuration**: Check environment variable setup above
- **🚀 Deployment**: Render deployment guide included

---

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## 🎉 Acknowledgments

- **Django REST Framework** for robust API development
- **SimpleJWT** for secure JWT implementation
- **Google OAuth** for seamless social authentication
- **Render** for simple deployment platform

---

**🔐 TEDx Authentication API** - Secure, tested, production-ready authentication for your applications.
